require=function e(t,c,i){function n(a,s){if(!c[a]){if(!t[a]){var r="function"==typeof require&&require;if(!s&&r)return r(a,!0);if(o)return o(a,!0);var h=new Error("Cannot find module '"+a+"'");throw h.code="MODULE_NOT_FOUND",h}var l=c[a]={exports:{}};t[a][0].call(l.exports,function(e){var c=t[a][1][e];return n(c||e)},l,l.exports,e,t,c,i)}return c[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)n(i[a]);return n}({Bean:[function(e,t,c){"use strict";cc._RF.push(t,"43f66aRdYhCG6ajsgfm4gkB","Bean"),cc.Class({extends:cc.Component,properties:{id:0,isExplore:!1,image1:{default:null,type:cc.SpriteFrame},image2:{default:null,type:cc.SpriteFrame},image3:{default:null,type:cc.SpriteFrame},image4:{default:null,type:cc.SpriteFrame},image5:{default:null,type:cc.SpriteFrame},image6:{default:null,type:cc.SpriteFrame},imageHit1:{default:null,type:cc.SpriteFrame},imageHit2:{default:null,type:cc.SpriteFrame},imageHit3:{default:null,type:cc.SpriteFrame},imageHit4:{default:null,type:cc.SpriteFrame},imageHit5:{default:null,type:cc.SpriteFrame},imageHit6:{default:null,type:cc.SpriteFrame},particleFactory:{default:null,type:cc.Prefab}},start:function(){},init:function(e,t,c,i){this.id=c,this.gameScene=i;var n;switch(c){case 1:n=this.image1;break;case 2:n=this.image2;break;case 3:n=this.image3;break;case 4:n=this.image4;break;case 5:n=this.image5;break;case 6:n=this.image6}this.setSpriteFrame(n)},setSpriteFrame:function(e){this.node.getComponent(cc.Sprite).spriteFrame=e,this.node.width=e.getRect().width,this.node.height=e.getRect().height},knock:function(){this.spriteArray[x][y].hit(),this.beansArray[x][y]=0},hit:function(){this.node.setLocalZOrder(2),this.node.stopAllActions(),this.node.removeAllChildren();var e;switch(this.id){case 1:e=this.imageHit1;break;case 2:e=this.imageHit2;break;case 3:e=this.imageHit3;break;case 4:e=this.imageHit4;break;case 5:e=this.imageHit5;break;case 6:e=this.imageHit6}this.setSpriteFrame(e),this.node.runAction(new cc.Sequence(new cc.ScaleTo(.1,1.3),new cc.ScaleTo(.1,1),new cc.DelayTime(.4),new cc.ScaleTo(.6,.5))),this.node.runAction(new cc.Sequence(new cc.DelayTime(.1*Math.random()),new cc.DelayTime(.2),new cc.EaseBackIn(new cc.MoveTo(.7,cc.p(434,1490))),new cc.CallFunc(this.clashStar,this)))},clashStar:function(){var e=cc.instantiate(this.particleFactory);e.getComponent("ParticalFactory").createStarEffect(2),e.setPosition(this.node.getPosition()),this.gameScene.getComponent("GameScene").boardNode.addChild(e),this.gameScene.updateScore(),this.node.removeFromParent()},explore:function(){this.vx=12*Math.random()-6,this.vy=8*Math.random()+8,this.isExplore},update:function(e){this.isExplore&&(this.node.setPosition(this.node.getPosition().x+this.vx,this.node.getPosition().y+this.vy),this.vy-=1,this.node.getPosition().y<-300&&this.removeFromParent())}}),cc._RF.pop()},{}],BtnMusic:[function(e,t,c){"use strict";cc._RF.push(t,"334e5IGnldOL7NofFPYsvg0","BtnMusic"),cc.Class({extends:cc.Component,properties:{callback:{default:null,type:cc.Node}},start:function(){this.node.on(cc.Node.EventType.TOUCH_START,function(e){return this.node.setScale(.9),!0},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){this.node.setScale(.9)},this),this.node.on(cc.Node.EventType.TOUCH_END,function(e){this.node.setScale(1)},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(e){this.node.setScale(1)},this)},gamePause:function(){}}),cc._RF.pop()},{}],BtnPause:[function(e,t,c){"use strict";cc._RF.push(t,"e92ee/+17dHiJ+mW7Doqn2G","BtnPause"),cc.Class({extends:cc.Component,properties:{gameCanvas:{default:null,type:cc.Node}},start:function(){this.node.on(cc.Node.EventType.TOUCH_START,function(e){return this.node.setOpacity(172),!0},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){this.node.setOpacity(172)},this),this.node.on(cc.Node.EventType.TOUCH_END,function(e){this.node.setOpacity(255),this.gamePause()},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(e){this.node.setOpacity(255)},this)},gamePause:function(){this.gameCanvas.getComponent("GameScene").gamePause()}}),cc._RF.pop()},{}],BtnRestart:[function(e,t,c){"use strict";cc._RF.push(t,"c2bd6mCp4BL5LtQbJxnBKUC","BtnRestart"),cc.Class({extends:cc.Component,properties:{callback:{default:null,type:cc.Node}},start:function(){this.node.on(cc.Node.EventType.TOUCH_START,function(e){return this.node.setScale(.9),!0},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){this.node.setScale(.9)},this),this.node.on(cc.Node.EventType.TOUCH_END,function(e){this.node.setScale(1)},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(e){this.node.setScale(1)},this)},gamePause:function(){}}),cc._RF.pop()},{}],BtnResume:[function(e,t,c){"use strict";cc._RF.push(t,"a4bb49dOnlAaZeqJ+OQXGAl","BtnResume"),cc.Class({extends:cc.Component,properties:{pauseLayer:{default:null,type:cc.Node}},start:function(){this.node.on(cc.Node.EventType.TOUCH_START,function(e){return this.node.setScale(.9),!0},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){this.node.setScale(.9)},this),this.node.on(cc.Node.EventType.TOUCH_END,function(e){this.node.setScale(1),this.gameResume()},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(e){this.node.setScale(1)},this)},gameResume:function(){this.pauseLayer.removeFromParent()}}),cc._RF.pop()},{}],BtnStart:[function(e,t,c){"use strict";cc._RF.push(t,"89ffd6VZ4hHVJXZlu5dALGM","BtnStart"),cc.Class({extends:cc.Component,properties:{},start:function(){this.node.setScale(0);var e=new cc.RepeatForever(new cc.Sequence(new cc.EaseSineInOut(new cc.ScaleTo(1,1)),new cc.EaseSineInOut(new cc.ScaleTo(1,.9))));this.node.runAction(e),this.node.on(cc.Node.EventType.TOUCH_START,function(e){this.node.setOpacity(172)},this),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(e){this.node.setOpacity(172)},this),this.node.on(cc.Node.EventType.TOUCH_END,function(e){this.node.setOpacity(255),this.gameStart()},this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,function(e){this.node.setOpacity(255)},this)},gameStart:function(){cc.director.loadScene("gameScene")}}),cc._RF.pop()},{}],CoinPartical:[function(e,t,c){"use strict";cc._RF.push(t,"fa4fahn1rhHWJ/25IgjrPP9","CoinPartical"),cc.Class({extends:cc.Component,properties:{vx:0,vy:0},start:function(){},setDt:function(e){this.node.setPosition(20*Math.random()-10,20*Math.random()-10),this.node.runAction(new cc.Sequence(new cc.DelayTime(.1*e),new cc.EaseBackIn(new cc.MoveTo(.7,cc.p(434,1490))),new cc.FadeTo(0,0)))}}),cc._RF.pop()},{}],GameScene:[function(e,t,c){"use strict";function i(e,t,c){return t in e?Object.defineProperty(e,t,{value:c,enumerable:!0,configurable:!0,writable:!0}):e[t]=c,e}function n(e,t){return t>=e.length&&(t=e.length-1),e[t]}function o(e,t){return e<=r.width-1&&e>=0&&t<=r.height-1&&t>=0}cc._RF.push(t,"53cf95SlpRGu5H5GQU1TFsy","GameScene");var a,s,r=cc.size(7,9),h=cc.size(144,144),l=[1,1,2],u=[0,0,0,0,10,10,10,20,20,20,50],p=[0,1e3,2250,3500,5e3,8e3,10500,13e3,16e3,2e4,25e3,32e3,38e3,46e3,5e4,53e3,58e3,68e3,75e3,84e3,1e5],d=[0,0,10,10,10,10,8,6,20,0,5,6,5,0,11,0,7,0,0,2,0],m=[0,0,0,1,1,1,3,2,2,0,2,2,6,30,2,3,2,2,6,2,5],f=[0,0,1,1,1,1,1,1,0,0,2,2,2,0,2,0,2,24,4,2,25],y=[0,4,4,5,5,5,5,5,5,4,5,5,5,5,5,6,6,5,6,6,4],w=[1],g=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,1,0,1,0,1,0,0,0,0,0,0,0,0,0,1,0,3,0,1,0,0,0,0,0,0,0,0,0,1,0,3,0,1,0,0,0,0,0,0,0,0,0,1,0,1,0,1,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,1,1,1,0,0,0,0,1,2,1,0,0,0,0,1,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,0,0,0,2,1,1,1,1,1,1,1,1,1,2,0,0,0,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,1,2,1,0,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,0,0,0,0,0,0,0,1,3,1,3,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,0,1,1,1,1,1,0,0,0,1,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,3],[0,0,0,1,0,0,0,0,0,1,3,1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,1,3,1,0,1,3,1,0,1,0,0,0,1,0,0,0,0,1,0,0,0,0,0,1,3,1,0,0,0,0,0,1,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,1,1,1,2,1,1,3,1,1,1,3,1,1,2,1,3,1,2,1,1,2,1,1,1,2,1,1,2,2,2,2,2,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,1,1,3,1,0,0,0,1,3,3,1,0,0,0,1,3,3,1,0,0,0,1,3,3,1,3,3,3,1,3],[1,3,1,3,1,3,1,3,0,0,0,0,0,3,1,0,0,0,0,0,1,3,0,0,0,0,0,3,1,0,0,0,0,0,1,3,0,0,0,0,0,3,1,0,0,0,0,0,1,3,0,0,0,0,0,3,1,3,1,3,1,3,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,1,1,2,0,0,0,2,1,1,1,1,0,1,1,1,1,2,1,1,1,2,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,3,3,3,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,3,0,0,0,0,0,3,0,3,0,0,0,3,0,0,0,3,0,3,0,0,0,0,0,3,0,0,0,0,0,0,0,3,0,0,0,0,0,3,0,3,0,0,0,3,0,0,0,3,0,3,0,0,0,0,0,3,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,2,0,0,0,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[1,1,1,0,0,0,0,1,0,0,0,0,0,0,1,1,1,0,0,0,0,1,0,0,0,0,0,0,1,1,1,0,1,1,0,0,0,0,0,1,0,1,0,0,0,0,1,0,1,0,0,0,0,1,0,1,0,0,0,0,1,1,0]];cc.Class({extends:cc.Component,properties:(a={topView:cc.Node,bottomView:cc.Node,boardNode:null,beansArray:[],spriteArray:[],countTempArray:[],count:null,untouch:!1,effect:null,score:0,realScore:0,scoreDisplay:0,powerDisplay:0,combo:0,comboTime:0,level:1,power:0,beanPrefab:{default:null,type:cc.Prefab},iceBlockPrefab:{default:null,type:cc.Prefab},labelLevelupPrefab:{default:null,type:cc.Prefab},pausePanel:{default:null,type:cc.Prefab}},i(a,"boardNode",{default:null,type:cc.Node}),i(a,"uiNode",{default:null,type:cc.Node}),i(a,"scoreLabel",{default:null,type:cc.Label}),i(a,"comboLabel",{default:null,type:cc.Label}),i(a,"levelLabel",{default:null,type:cc.Label}),i(a,"comboTag",{default:null,type:cc.Node}),i(a,"progressBar",{default:null,type:cc.Node}),a),start:function(){s=this;for(var e=0;e<r.width;e++)this.beansArray[e]=new Array,this.spriteArray[e]=new Array,this.countTempArray[e]=new Array;this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this.onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this.onTouchEnded,this),this.showBars(),this.putBlocks()},onTouchBegan:function(e){if(this.untouch)return!1},onTouchMove:function(e){},onTouchEnded:function(e){var t=this.boardNode.convertToNodeSpace(e.getLocation());t.x+=h.width/2,t.y+=h.height/2;var c=Math.floor(t.x/h.width),i=Math.floor(t.y/h.height);this.clickxy(c,i)},newGame:function(){this.level=1,this.levelLabel.string=1,this.combo=0,this.score=0,this.realScore=0,this.scoreDisplay=0,this.scoreLabel.string=0,this.clearCombo(),this.putBlocks(),this.updatePowerBar(),this.showHint()},clearBoard:function(){this.untouch=!0;for(var e=0;e<r.width;e++)for(var t=0;t<r.height;t++)this.spriteArray[e][t].runAction(new cc.Sequence(new cc.DelayTime(.1*(r.height-t-1)),new cc.Spawn(new cc.FadeTo(.3,0),new cc.EaseQuadraticActionOut(new cc.ScaleTo(.5,0))),new cc.CallFunc(this.spriteArray[e][t].removeFromParent,this.spriteArray[e][t])));this.boardNode.runAction(new cc.Sequence(new cc.DelayTime(1.3),new cc.CallFunc(this.boardNode.removeAllChildren,this.boardNode)))},putBlocks:function(){this.clearCombo(),this.node.runAction(new cc.Sequence(new cc.DelayTime(1.2),new cc.CallFunc(function(){s.untouch=!1}))),this.boardNode.removeAllChildren();for(var e=0;e<r.width;e++)for(var t=0;t<r.height;t++){var c=n(g,this.level);if(0!=c[e+(r.height-t-1)*r.width])this.putBall(e,t,-c[e+(r.height-t-1)*r.width]);else{var i=Math.floor(Math.random()*n(y,this.level))+1;this.putBall(e,t,i)}}},putBallRandom:function(e,t){if(n(d,this.level)>100*Math.random())this.putBall(e,t,-1);else if(n(m,this.level)>100*Math.random())this.putBall(e,t,-2);else if(n(f,this.level)>100*Math.random())this.putBall(e,t,-3);else{var c=Math.floor(Math.random()*n(y,this.level))+1;this.putBall(e,t,c)}},putBall:function(e,t,c){this.beansArray[e][t]=c,c<0?(this.spriteArray[e][t]=cc.instantiate(this.iceBlockPrefab),this.spriteArray[e][t].getComponent("IceBlock").init(e,t,c,this)):(this.spriteArray[e][t]=cc.instantiate(this.beanPrefab),this.spriteArray[e][t].getComponent("Bean").init(e,t,c,this)),this.spriteArray[e][t].setPosition(e*h.width,t*h.height+r.height*h.height),this.spriteArray[e][t].setOpacity(0),this.spriteArray[e][t].runAction(new cc.Sequence(new cc.DelayTime(1-1*(r.height-t)/r.height),new cc.FadeTo(.1,255)));var i=1.25-t/r.height;this.spriteArray[e][t].runAction(new cc.Sequence(new cc.EaseQuadraticActionIn(new cc.MoveBy(1+.3*(1-i),cc.p(0,-r.height*h.height))),this.effect,new cc.EaseSineOut(new cc.ScaleTo(.16,1+.2*i,1-.07*i)),new cc.EaseSineOut(new cc.ScaleTo(.08,1-.05*i,1+.08*i)),new cc.EaseSineOut(new cc.ScaleTo(.05,1,1)))),this.boardNode.addChild(this.spriteArray[e][t])},clickxy:function(e,t){if(!(e<0||e>=r.width||t<0||t>=r.height||this.beansArray[e][t]<=0)){this.count=0;for(c=0;c<r.width;c++)for(i=0;i<r.height;i++)this.countTempArray[c][i]=0;if(this.countNear(e,t),this.count>=2){for(c=0;c<r.width;c++)for(i=0;i<r.height;i++)1==this.countTempArray[c][i]&&(this.hitBean(c,i),c-1>=0&&this.beansArray[c-1][i]<0&&(this.countTempArray[c-1][i]=-1),i-1>=0&&this.beansArray[c][i-1]<0&&(this.countTempArray[c][i-1]=-1),c+1<r.width&&this.beansArray[c+1][i]<0&&(this.countTempArray[c+1][i]=-1),i+1<r.height&&this.beansArray[c][i+1]<0&&(this.countTempArray[c][i+1]=-1));for(var c=0;c<r.width;c++)for(var i=0;i<r.height;i++)-1==this.countTempArray[c][i]&&this.beansArray[c][i]<0&&this.spriteArray[c][i].getComponent("IceBlock").knock();switch(this.fillBoard(),this.comboTime<2?this.getCombo():this.clearCombo(),this.combo){case 3:cc.audioEngine.playEffect("res/music/hit_3.mp3");break;case 6:cc.audioEngine.playEffect("res/music/hit_4.mp3");break;case 9:cc.audioEngine.playEffect("res/music/hit_5.mp3");break;default:cc.audioEngine.playEffect("res/music/hit_2.mp3")}var o=(10*this.count*n(l,this.combo)+n(u,this.count))*n(w,this.level);this.getScore(o)}}},countNear:function(e,t){this.count++,this.countTempArray[e][t]=1,o(e+1,t)&&0==this.countTempArray[e+1][t]&&this.beansArray[e+1][t]==this.beansArray[e][t]&&this.countNear(e+1,t),o(e-1,t)&&0==this.countTempArray[e-1][t]&&this.beansArray[e-1][t]==this.beansArray[e][t]&&this.countNear(e-1,t),o(e,t+1)&&0==this.countTempArray[e][t+1]&&this.beansArray[e][t+1]==this.beansArray[e][t]&&this.countNear(e,t+1),o(e,t-1)&&0==this.countTempArray[e][t-1]&&this.beansArray[e][t-1]==this.beansArray[e][t]&&this.countNear(e,t-1)},fillBoard:function(){for(n=0;n<r.width;n++)for(c=0;c<r.height;c++)this.countTempArray[n][c]=0;for(n=0;n<r.width;n++)for(c=0;c<r.height;c++)if(0==this.beansArray[n][c]){cc.log(this.beansArray[n][c]);for(var e=c+1;e<r.height;e++)this.countTempArray[n][e]++}for(n=0;n<r.width;n++)for(var t=new cc.CallFunc(this.playDropEffect,this),c=0;c<r.height;c++)if(0!=this.beansArray[n][c]&&0!=this.countTempArray[n][c]){this.beansArray[n][c]<0?this.spriteArray[n][c].getComponent("IceBlock").cy=c-this.countTempArray[n][c]:this.spriteArray[n][c].getComponent("Bean").cy=c-this.countTempArray[n][c],this.beansArray[n][c-this.countTempArray[n][c]]=this.beansArray[n][c],this.beansArray[n][c]=0;var i=1.25-c/r.height;this.spriteArray[n][c].runAction(new cc.Sequence(new cc.DelayTime((1+.3*(1-i))*(1-this.countTempArray[n][c]/r.height)),new cc.EaseQuadraticActionIn(new cc.MoveBy(1*this.countTempArray[n][c]/r.height,cc.p(0,-this.countTempArray[n][c]*h.width))),t,new cc.EaseSineOut(new cc.ScaleTo(.16,1+.2*i,1-.07*i)),new cc.EaseSineOut(new cc.ScaleTo(.08,1-.05*i,1+.07*i)),new cc.EaseSineOut(new cc.ScaleTo(.05,1,1)))),this.spriteArray[n][c-this.countTempArray[n][c]]=this.spriteArray[n][c],t=new cc.DelayTime(0)}for(var n=0;n<r.width;n++){this.effect=new cc.CallFunc(this.playDropEffect,this);for(c=0;c<r.height;c++)0==this.beansArray[n][c]&&this.putBallRandom(n,c);this.effect=new cc.DelayTime(0)}this.checkFail()&&this.gameOver()},checkFail:function(){if(this.untouch)return!1;for(e=0;e<r.width;e++)for(t=0;t<r.height;t++)this.countTempArray[e][t]=0;for(var e=0;e<r.width;e++)for(var t=0;t<r.height;t++){if(-2==this.beansArray[e][t]&&this.spriteArray[e][t].time<=0)return!1;if(!(this.beansArray[e][t]<0)&&(this.count=0,this.countNear(e,t),this.count>1))return!1}return!0},hitBean:function(e,t){this.beansArray[e][t]<0?this.spriteArray[e][t].getComponent("IceBlock").hit():this.beansArray[e][t]>0&&(this.spriteArray[e][t].getComponent("Bean").hit(),this.beansArray[e][t]=0)},getCombo:function(){this.comboTime=0,++this.combo>=2&&(this.comboLabel.string=":"+this.combo,this.comboLabel.node.stopAllActions(),this.comboLabel.node.setScale(1.5),this.comboLabel.node.runAction(new cc.Sequence(new cc.EaseSineIn(new cc.ScaleTo(.05,1.7)),new cc.EaseSineIn(new cc.ScaleTo(.1,1.5)))),this.comboTag.stopAllActions(),this.comboTag.setOpacity(255),this.comboTag.setPosition(540,1650),this.comboTag.setScale(1),this.comboTag.runAction(new cc.Sequence(new cc.ScaleTo(.1,1.25),new cc.DelayTime(.6),new cc.FadeTo(.8,0))))},clearCombo:function(){this.combo=0,this.comboTime=0,this.comboLabel.string=":"+this.combo},updatePowerBar:function(){var e=(this.score-p[this.level-1])/(p[this.level]-p[this.level-1]);this.powerDisplay+=(e-this.powerDisplay)/50,this.powerDisplay>1&&(this.powerDisplay=1),this.powerDisplay<0&&(this.powerDisplay=0),this.progressBar.width=791*this.powerDisplay},getScore:function(e){var t=Math.floor(e);this.realScore+=t,this.node.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.CallFunc(function(){s.score+=t}))),this.realScore>=p[this.level]&&this.levelUp()},levelUp:function(){s.level++,cc.audioEngine.playEffect("res/music/level_up.mp3"),this.node.runAction(new cc.Sequence(new cc.DelayTime(3),new cc.CallFunc(function(){s.levelLabel.string=s.level})));var e=cc.instantiate(this.labelLevelupPrefab);e.setPosition(540,880),e.setOpacity(0),e.runAction(new cc.Sequence(new cc.FadeTo(.4,255),new cc.MoveBy(.4,cc.p(0,200)),new cc.DelayTime(.5),new cc.FadeTo(.4,255),new cc.MoveBy(.4,cc.p(0,200)),new cc.CallFunc(e.removeFromParent,e))),this.uiNode.addChild(e),this.untouch=!0,this.level>20?(this.level=20,this.node.runAction(new cc.Sequence(new cc.DelayTime(4),new cc.CallFunc(this.showOverLayer,this)))):this.node.runAction(new cc.Sequence(new cc.DelayTime(3.5),new cc.CallFunc(this.putBlocks,this))),this.node.runAction(new cc.Sequence(new cc.DelayTime(1.75),new cc.CallFunc(this.clearBoard,this)));for(var t=0;t<r.width;t++)for(var c=0;c<r.height;c++)-2==this.beansArray[t][c]&&(this.spriteArray[t][c].cancleItem=!0)},updateScore:function(){this.scoreLabel.node.stopAllActions(),this.scoreLabel.node.runAction(new cc.Sequence(new cc.EaseSineIn(new cc.ScaleTo(.05,1.7)),new cc.EaseSineIn(new cc.ScaleTo(.1,1.5))))},restart:function(){},gameOver:function(){},showOverLayer:function(){},showHint:function(){},gamePause:function(){this.uiNode.addChild(cc.instantiate(this.pausePanel))},showBars:function(){this.bottomView.runAction(new cc.EaseSineOut(new cc.MoveBy(.4,cc.p(0,200)))),this.topView.runAction(new cc.EaseSineOut(new cc.MoveBy(.4,cc.p(0,-200))))},hideBars:function(){this.bottomView.runAction(new cc.EaseSineOut(new cc.MoveBy(.4,cc.p(0,200)))),this.topView.runAction(new cc.EaseSineOut(new cc.MoveBy(.4,cc.p(0,-200))))},update:function(e){this.comboTime+=e,this.scoreDisplay<this.score&&(this.scoreDisplay+=Math.ceil((this.score-this.scoreDisplay)/30),this.scoreLabel.string=this.scoreDisplay),this.updatePowerBar()}}),cc._RF.pop()},{}],IceBlock:[function(e,t,c){"use strict";function i(e,t){return e<=n.width-1&&e>=0&&t<=n.height-1&&t>=0}cc._RF.push(t,"01d04yt6B5Ac4b6ihASWWPT","IceBlock");var n=cc.size(7,9);cc.Class({extends:cc.Component,properties:{time:0,item:0,cancleItem:!1,isExplore:!1,sp:{default:null,type:cc.Node},bombImage:{default:null,type:cc.SpriteFrame},coinImage:{default:null,type:cc.SpriteFrame},iceImage1:{default:null,type:cc.SpriteFrame},iceImage2:{default:null,type:cc.SpriteFrame},iceImage3:{default:null,type:cc.SpriteFrame},particleFactory:{default:null,type:cc.Prefab}},start:function(){},init:function(e,t,c,i){this.cx=e,this.cy=t,this.item=c,this.time=3,this.gameScene=i;var n;switch(c){case-2:n=this.bombImage;break;case-3:n=this.coinImage}-1!=c&&this.setSpriteFrame(n)},setSpriteFrame:function(e){this.node.getComponent(cc.Sprite).spriteFrame=e,this.node.width=e.getRect().width,this.node.height=e.getRect().height},knock:function(){if(2==--this.time&&(this.sp.getComponent(cc.Sprite).spriteFrame=this.iceImage2),1==this.time&&(this.sp.getComponent(cc.Sprite).spriteFrame=this.iceImage3),0==this.time)this.hit();else{var e=cc.instantiate(this.particleFactory);e.getComponent("ParticalFactory").createIceEffect(7-2*this.time),e.setPosition(this.node.getPosition()),this.gameScene.getComponent("GameScene").boardNode.addChild(e);var t=16*Math.random()-8,c=16*Math.random()-8;this.node.runAction(new cc.Sequence(new cc.EaseSineIn(new cc.MoveBy(.05,cc.p(t,c))),new cc.EaseSineIn(new cc.MoveBy(.05,cc.p(-2*t,-2*c))),new cc.EaseSineIn(new cc.MoveBy(.05,cc.p(t,c)))))}cc.audioEngine.playEffect("res/music/ice_clash.mp3")},hit:function(){-2==this.item?(this.time=0,this.node.runAction(new cc.Sequence(new cc.DelayTime(1.3),new cc.CallFunc(this.itemBomb,this))),this.sp.removeFromParent(),this.node.runAction(new cc.Sequence(new cc.ScaleTo(.4,1.05),new cc.ScaleTo(.4,.9),new cc.ScaleTo(.5,1.2)))):-3==this.item?(this.time=0,this.node.runAction(new cc.Sequence(new cc.DelayTime(.4),new cc.CallFunc(this.itemCoin,this))),this.sp.removeFromParent(),this.node.runAction(new cc.Spawn(new cc.ScaleTo(.4,1.1),new cc.FadeTo(.4,0)))):(this.gameScene.getScore(4),this.gameScene.beansArray[this.cx][this.cy]=0,this.node.removeFromParent());var e=cc.instantiate(this.particleFactory);e.getComponent("ParticalFactory").createIceEffect(7),e.setPosition(this.node.getPosition()),this.gameScene.getComponent("GameScene").boardNode.addChild(e);var t=16*Math.random()-8,c=16*Math.random()-8;this.node.runAction(new cc.Sequence(new cc.EaseSineIn(new cc.MoveBy(.05,cc.p(t,c))),new cc.EaseSineIn(new cc.MoveBy(.05,cc.p(-2*t,-2*c))),new cc.EaseSineIn(new cc.MoveBy(.05,cc.p(t,c)))))},itemBomb:function(){if(!this.cancleItem){this.gameScene.getScore(80);for(var e=this.cx-1;e<=this.cx+1;e++)for(var t=this.cy-1;t<=this.cy+1;t++)if(i(e,t)&&null!=this.gameScene.beansArray[e][t]&&0!=this.gameScene.beansArray[e][t]){if(e==this.cx&&t==this.cy)continue;this.gameScene.hitBean(e,t)}this.gameScene.beansArray[this.cx][this.cy]=0,this.gameScene.fillBoard()}cc.audioEngine.playEffect("res/music/bomb.mp3");var c=cc.instantiate(this.particleFactory);c.getComponent("ParticalFactory").createStarEffect(5),c.setPosition(this.node.getPosition()),this.gameScene.getComponent("GameScene").boardNode.addChild(c),this.node.removeFromParent()},itemCoin:function(){if(!this.cancleItem){this.gameScene.getScore(250),cc.audioEngine.playEffect("res/music/item_coin.mp3"),this.gameScene.beansArray[this.cx][this.cy]=0,this.gameScene.fillBoard();var e=cc.instantiate(this.particleFactory);e.getComponent("ParticalFactory").createCoinEffect(5,this.node.getPosition()),this.gameScene.getComponent("GameScene").boardNode.addChild(e),this.node.removeFromParent()}},explore:function(){this.vx=12*Math.random()-6,this.vy=8*Math.random()+8,this.scheduleUpdate(),this.isExplore=!0},update:function(e){this.isExplore&&(this.setPosition(this.getPosition().x+this.vx,this.getPosition().y+this.vy),this.vy-=1,this.getPosition().y<-300&&this.removeFromParent())}}),cc._RF.pop()},{}],IcePartical:[function(e,t,c){"use strict";cc._RF.push(t,"532fa8aUXlMsoS2Z35Kwc7q","IcePartical"),cc.Class({extends:cc.Component,properties:{vx:0,vy:0},start:function(){this.node.setPosition(80*Math.random()-40,80*Math.random()-40),this.node.setRotation(360*Math.random()),this.node.setScale(1*Math.random()+.5,1*Math.random()+.5),this.vx=12*Math.random()-6,this.vy=9*Math.random()},update:function(e){this.vy-=1,this.node.setPosition(this.node.getPosition().x+this.vx,this.node.getPosition().y+this.vy)}}),cc._RF.pop()},{}],OverLayer:[function(e,t,c){"use strict";cc._RF.push(t,"af960FQqfBCK7Ib/VSh1pXl","OverLayer"),cc.Class({extends:cc.Component,properties:{},start:function(){this.node.on(cc.Node.EventType.TOUCH_START,function(e){e.stopPropagation()},this)}}),cc._RF.pop()},{}],ParticalFactory:[function(e,t,c){"use strict";cc._RF.push(t,"3e421q83CVPK5jrTysl0uwM","ParticalFactory"),cc.Class({extends:cc.Component,properties:{iceParticle:{default:null,type:cc.Prefab},starParticle:{default:null,type:cc.Prefab},coinParticle:{default:null,type:cc.Prefab}},start:function(){},createIceEffect:function(e){for(var t=0;t<e;t++)this.node.addChild(cc.instantiate(this.iceParticle));this.node.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.CallFunc(this.node.removeFromParent,this.node)))},createStarEffect:function(e){for(var t=0;t<e;t++)this.node.addChild(cc.instantiate(this.starParticle));this.node.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.CallFunc(this.node.removeFromParent,this.node)))},createCoinEffect:function(e,t){cc.log(t);for(var c=0;c<e;c++){var i=cc.instantiate(this.coinParticle);i.getComponent("CoinPartical").setDt(c),i.setPosition(t),this.node.addChild(i)}this.node.runAction(new cc.Sequence(new cc.DelayTime(1),new cc.CallFunc(this.node.removeFromParent,this.node)))}}),cc._RF.pop()},{}],StarPartical:[function(e,t,c){"use strict";cc._RF.push(t,"a0c5fRCHAlFJqrskeukflzW","StarPartical"),cc.Class({extends:cc.Component,properties:{},start:function(){this.node.setPosition(20*Math.random()-10,20*Math.random()-10),this.node.setRotation(360*Math.random()),this.node.setScale(2),this.node.runAction(new cc.EaseQuadraticActionOut(new cc.MoveBy(.5,cc.p(300*Math.random()-150,300*Math.random()-150)))),this.node.runAction(new cc.RotateBy(.5,1e3*Math.random()-5e3)),this.node.runAction(new cc.FadeTo(.5,0))}}),cc._RF.pop()},{}]},{},["Bean","BtnMusic","BtnPause","BtnRestart","BtnResume","CoinPartical","GameScene","IceBlock","IcePartical","OverLayer","ParticalFactory","StarPartical","BtnStart"]);